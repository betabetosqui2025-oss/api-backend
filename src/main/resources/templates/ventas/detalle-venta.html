<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      th:replace="~{layouts/admin-layout :: admin-layout(pageTitle=${pageTitle}, content=~{::content})}">
<head>
    <title th:text="${pageTitle ?: 'Detalle de Venta'}">Detalle de Venta</title>
    <style>
        @media print {
            body * { visibility: hidden; }
            #printableArea, #printableArea * { visibility: visible; }
            #printableArea { position: absolute; left: 0; top: 0; width: 100%; }
            .no-print { display: none !important; }
            .card { box-shadow: none !important; border: 1px solid #ccc !important; }
        }
    </style>
</head>
<body>
<th:block th:fragment="content">
    <div class="d-flex justify-content-between align-items-center mb-4 no-print">
        <h1 class="h3 mb-0 text-gray-800" th:text="${pageTitle}">Detalle de Venta</h1>
        <div>
            <button type="button" onclick="window.print();" class="btn btn-info btn-icon-split mr-2">
                <span class="icon text-white-50"><i class="fas fa-print"></i></span>
                <span class="text">Imprimir</span>
            </button>
            <a th:href="@{/ventas}" class="btn btn-outline-secondary btn-icon-split">
                <span class="icon text-gray-600"><i class="fas fa-arrow-left"></i></span>
                <span class="text">Volver al Historial</span>
            </a>
        </div>
    </div>

    <div id="printableArea">
        <div class="card shadow mb-4">
            <div class="card-header py-3">
                 <h6 class="m-0 font-weight-bold text-primary"><i class="fas fa-file-invoice-dollar mr-2"></i>Factura NÂ°: <span th:text="${venta?.numeroFactura}"></span></h6>
            </div>
            <div class="card-body" th:if="${venta}">
                <div class="row mb-4">
                    <div class="col-md-6 mb-3 mb-md-0">
                        </div>
                    <div class="col-md-6 text-md-right">
                        </div>
                </div>

                <h6 class="mt-4 mb-3 font-weight-bold text-primary">Productos Vendidos:</h6>
                <div class="table-responsive">
                    <table class="table table-bordered">
                        <thead class="thead-light">
                            <tr>
                                <th>Producto</th>
                                <th class="text-center">Cantidad</th>
                                <th class="text-right">Precio Unitario</th>
                                <th class="text-right">Subtotal</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr th:each="detalle : ${venta.detalles}">
                                <td th:text="${detalle.nombreProducto}"></td>
                                <td class="text-center" th:text="${detalle.cantidad}"></td>
                                <td class="text-right" th:text="${#numbers.formatCurrency(detalle.precioUnitario)}"></td>
                                <td class="text-right" th:text="${#numbers.formatCurrency(detalle.subtotal)}"></td>
                            </tr>
                        </tbody>
                        <tfoot>
                            <tr style="background-color: #f8f9fc;">
                                <td colspan="3" class="text-right font-weight-bold border-top-0">SUBTOTAL:</td>
                                <td class="text-right font-weight-bold border-top-0" th:text="${#numbers.formatCurrency(venta.subtotal)}"></td>
                            </tr>
                            <tr>
                                <td colspan="3" class="text-right font-weight-bold border-top-0" th:text="'IVA (' + ${venta.porcentajeIva} + '%):'"></td>
                                <td class="text-right font-weight-bold border-top-0" th:text="${#numbers.formatCurrency(venta.montoIva)}"></td>
                            </tr>
                            <tr class="bg-primary text-white">
                                <td colspan="3" class="text-right font-weight-bold h5 border-top-0">TOTAL VENTA:</td>
                                <td class="text-right font-weight-bold h5 border-top-0" th:text="${#numbers.formatCurrency(venta.totalVenta)}"></td>
                            </tr>
                        </tfoot>
                    </table>
                </div>

                </div>
        </div>
    </div>
</th:block>
</body>
</html>